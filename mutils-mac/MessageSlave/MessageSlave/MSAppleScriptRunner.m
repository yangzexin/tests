//
//  MSAppleScriptRunner.m
//  MessageSlave
//
//  Created by yangzexin on 13-4-12.
//  Copyright (c) 2013å¹´ yangzexin. All rights reserved.
//

#import "MSAppleScriptRunner.h"
#import "SVCodeUtils.h"

static const char *kRunnerAppHex = "fcafdeef7000001030000008200000003100000002a0000058000200000000009100000084000000f5f505147454a55425f40000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000009100000081300000f5f54554854500000000000000000000000000001000000000030000000000000000000000000000000300000000000070000000500000009000000000000000f5f54756874700000000000000000000f5f54554854500000000000000000000085100001000000052310000000000000851000040000000000000000000000000400008000000000000000000000000f5f53747572637000000000000000000f5f545548545000000000000000000006a8200001000000063000000000000006a82000010000000000000000000000080400008000000006000000000000000f5f537475726f58656c6075627000000f5f54554854500000000000000000000cd82000010000000a600000000000000cd82000020000000000000000000000000400008000000000000000000000000f5f5f626a636f5d6564786e616d65600f5f54554854500000000000000000000649200001000000009200000000000006492000000000000000000000000000020000000000000000000000000000000f5f53637472796e67600000000000000f5f545548545000000000000000000006db20000100000007a000000000000006db2000000000000000000000000000020000000000000000000000000000000f5f5f626a636f536c6163737e616d656f5f54554854500000000000000000000d7c20000100000009100000000000000d7c2000000000000000000000000000020000000000000000000000000000000f5f5f626a636f5d65647864797075600f5f5455485450000000000000000000069c2000010000000830000000000000069c2000000000000000000000000000020000000000000000000000000000000f5f557e67796e646f596e666f6000000f5f54554854500000000000000000000ecc20000100000000600000000000000ecc2000000000000000000000000000000000000000000000000000000000000f5f55686f5662716d656000000000000f5f5455485450000000000000000000003d20000100000000d2000000000000003d20000300000000000000000000000000000000000000000000000000000009100000080400000f5f5441445140000000000000000000000030000100000000001000000000000000300000000000000010000000000007000000030000000c000000000000000f5f5e6c6f53797d626f6c6f507472700f5f54414451400000000000000000000000300001000000001000000000000000003000030000000000000000000000060000000900000000000000000000000f5f576f6470000000000000000000000f5f54414451400000000000000000000010300001000000001000000000000000103000030000000000000000000000060000000b00000000000000000000000f5f5c616f53797d626f6c6f507472700f5f54414451400000000000000000000020300001000000084000000000000000203000030000000000000000000000070000000d00000000000000000000000f5f5f626a636f536c6163737c6963747f5f54414451400000000000000000000860300001000000001000000000000008603000030000000000000000000000000000001000000000000000000000000f5f5f626a636f596d616765696e666f6f5f54414451400000000000000000000870300001000000080000000000000008703000020000000000000000000000000000000000000000000000000000000f5f5f626a636f536f6e6374700000000f5f54414451400000000000000000000080300001000000089200000000000000803000030000000000000000000000000000000000000000000000000000000f5f5f626a636f53756c6275666370000f5f5441445140000000000000000000081330000100000008e000000000000008133000030000000000000000000000050000001000000000000000000000000f5f5f626a636f5d63776275666370000f5f54414451400000000000000000000004300001000000005000000000000000043000040000000000000000000000000000000000000000000000000000000f5f5f626a636f536c616373727566637f5f54414451400000000000000000000054300001000000003000000000000000543000030000000000000000000000000000001000000000000000000000000f5f5f626a636f5461647160000000000f5f5441445140000000000000000000008430000100000000a000000000000000843000030000000000000000000000000000000000000000000000000000000f5f5366637472796e676000000000000f5f54414451400000000000000000000025300001000000000100000000000000253000030000000000000000000000000000000000000000000000000000000f5f54616471600000000000000000000f5f544144514000000000000000000000263000010000000800000000000000002630000300000000000000000000000000000000000000000000000000000009100000084000000f5f5c494e4b4544494450000000000000004000010000000000200000000000000040000000000000b510000000000007000000010000000000000000000000022000008030000000004000003000000030400008b10000000000000000000008e1400000b000000892400000a000000200000008100000088340000d70000000bb4000000a00000b00000000500000000000000260000002600000060000000860000005100000000000000000000000000000000000000000000000000000085b400006100000000000000000000000000000000000000e000000002000000c0000000f2573727f2c69626f24697c64600000000000000b100000081000000672914ca1fe8b3edb851a1704ea4c2d042000000010000000080a0000080a000a2000000010000000000000000000000820000088100000008510000000000000000000000000000c000000006000000810000002000000000b01b300000c210f23597374756d6f2c4962627162797f2642716d65677f627b637f264f657e646164796f6e6e2662716d65677f627b6f26556273796f6e637f234f264f657e646164796f6e6000000c000000083000000810000002000000000004e0000001000f2573727f2c69626f2c69626f626a636e214e24697c696260000000000000000c000000083000000810000002000000000309a0000001000f2573727f2c69626f2c696263597374756d6e224e24697c69626000000000000c000000086000000810000002000000000108e2000006900f23597374756d6f2c4962627162797f2642716d65677f627b637f234f6275664f657e646164796f6e6e2662716d65677f627b6f26556273796f6e637f214f234f6275664f657e646164796f6e60000006200000001000000833400000200000092000000010000008534000000000000b20000000100000085340000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005584985e8438ce027c54cf0000000098d78f8498570f8e7131000018d78f100000008498540ef0e8b200000084b8540f84b804808498548e84b85019e1000084b8558e84b853e4d1000084987c8e6e2100009e1100000084d85024f1000084987c0b008eeb21000084b8d70e8ebb2100008b0000000084384c02d53c090909095584985e8418ce0900000084d850e2f1000084d8d40dc4d8503fd10000c4d8d0cdd100008498d78f8498570f8498558e84b85112e1000084b8578e84b8d3edc100008498d70c84987d84b8550c8498578b84986d84b8558bc498540b8498d48ac498d40a849854898eb42100008498540e84b8508ed1000084b8550e84b8535ac1000084987c8ed22100008498540e84b8502dd1000084987c84b8570aff51d5d1000084b8550e84b85328c1000084987c8e2021000084987c84b8570bff51d4d100008498548d847c540d0000000084b8548d84b853e5c1000084987c84b8558a8e2d11000084b8570d84b8d7898854790b008eea11000084d8d016e1000084d8558c847c548c0000000084b8578d84b8d3a2c100008498d78884987f84b857888498d4088ee811000084b8578c84b8d70884985887ffffff0b008e6611000084184c09000000d53c090909090909095584985e880d8498d78f8498570f8854fe84b8538be10000f06b55fe8436aff0eb40e3d53c6666e2f0f14800000000005584985e8438ce03880d8498d70f8498578e88547e84b8d348e100008e53110000982c98550e7c54cd00000000b854cdb3540ef0d8d3000000f0eb547e84b8d0c5e10000843655cdf0eb4311930ff058d0000000b854cd881c88d4ff9e910000009e00000000b854cd50100000009854cd9e7bffffff6c54ff00f06b54ff84384c03d53c666666e2f0f14800000000005584985e8438ce0684d85010c100008498d78f8498570f8498558e84b8558e84987d84986cff515eb10000841c0e0084987c8e9801000084d8512db100008498540e84b8548e84b8570e84b8d37ea100008498d78b84987c84b8548b8498570b84986c84b8d40b8498558a8498ac8e5301000084b8548e84987c84b8578aff51c8b10000841c0e00841c0e1084501000000014980c449854cd8436d7cd8ee10100008498540d7c54cc0000000084d850c5b100008436d4cc84b8558e84987d84986c8498d40aff5144b1000084b8d40a84931cf038a900000084b8540e8436d4cca841808855bcf06b57bc186ef000000004882f8855acf06b57bc186e0f0000001cef4004882f88559c84b850f3b10000a855ac84b85352a1000084987cf06b2d8e28f0000084b8d40db855cc1c2e1084362f88401384b8d031b10000a8549c84b8539f9100008498fcf06b0d8e65f0000084b8d40db855cc1c2e1084362f88441310b854cc50100000009854cc9ea3ffffff84b8d70e8ee3f0000084b8d70d843654cd6c4470ff0084b8508ba1000084b8550d84b8535791000084987c8e50f000008498540c84b8d70d8ea0f0000084b8540c84384c06d53c66f0f14400005584985e8438ce0384d85015a1000084d8d0a9b100008498d70f8498578e8498550e84b8550e84987d84986c8498acff51b2a10000c300f0480100000084d850c6b100008498548f9e9300000084ab400000000000000084b8540e84b8536291000084987c8ee7e000008498548d84b8d70f84b8558d84b853319100008e66e000008498548f84b8548f84384c03d53c5584985e8438ce0784d8501c91000084d8d0a0b100008498d70f8498578e8498550e84b8550e84987d84986c8498acff51b9910000c300f048d0000000847c548f000000009edd10000084d850f691000084b8d40e8498fc84986cff51f591000084521000000084d300000000f048d0000000847c548f000000009e7a10000084d8509391000084b8d40e8498fc84986cff5192910000841c0e00841c8e10982c9855cd8436d7cd8e3cd0000084d8d0c091000084ab40000000000000008498540d84b8540e84b853b281000084987c8498d40a8ef7d000008498548c84b8548c84987c84b8570aff512d810000841c0e0084987c8e67d000008498540c84b8548c84b8550c84b853bd71000084987c8e34d000007c54cb000000007c548b0000000084d850698100008436d4cb84b8558c84987d84986c8498d489ff51e781000084b8d48984931cf038f900000084b850aa81000084b8d40c843655cb04a8431184b8d0f971000084987c048857798498ec44a8547914f0eb0d8e8dc0000088547b84b8d06781000084b8570c8436d7cba844e31084b853b67100008498fcf0eb0d8e0bc0000088546bf06b556b1c2e40182e0f00000044f06bd47b4410ac880d88545ba8545b84b8d40d8436578b884013b854cb50200000009854cbb8548b501000000098548b9e53ffffff84b8d70c8e37c0000084b8d32181000084b8550d8436d4cd84b853307100008e64c000008498548a84b8d70d8eb4c0000084b8548a8498548f84b8548f84384c07d53c666666666666e2f0f14800000000005584985e8438ce0484d85016710000849b4000000000000000c4d850047100008498d78f8498570f8498558e84b8515871000084987dc4986c8498d48d8498540dff519171000084b8d78f84b8558e84b853286100008498548c8e9bb0000084b853a761000084b8d48c8498fc84982c84b8d48d8ef9b0000084987c84b8570dff51ae6100008498540e84b8540e84384c04d53c666666e2f0f14800000000005584985e8438ce0466980d84d8d0ee610000948b200000000000000084d855ae8498d78f8498570f669854ee44f07bd4ee14181eff0000005488ac448855de44f07bd4ee14181e00ff0000141c9f805488ac448855ce44a855de448855ae44a855ce448855be84b8533c61000084b8d3cb5100008498d70d84987f84b8570d8498d48cc4981c8edea000008498540e84b8d78f84b8578cff513661000084b8550e84b8538751000084987c8e8ca000008498548d84b8548d84384c04d53c66095584985e1465358438ce05849b100000000000000084d854ac948b2000000000000000c4d8d4ecc4d851216100008498d78e8498570e8498558d84b8d78ec4986dc498d40cc498548b8498540b8498d48aff519e51000084b8558d84b8536151000084987c8ee4a000008498540d84b8540d84b853f051000084987c84b8550c84b8d48b8ef2a0000044f06bd5ecf06bd5fc1c3e801410bd665498ed66449857cc6644b857cc66449857ac84b8506a51000084b8537d41000084987c84b8550b84b8d48a8efe90000084384c05b514e5d53c6666666666e2f0f14800000000005584985e8438ce068498d78f8498570f8498558e84b851d751000084b8536941000084987d8eea9000008498540e847c548d0000000084d8503051000084b8d48d84b8558e84987d84986c8498d48cff51be41000084b8d48c84931cf0383f00000084b8548e84b8558d84b853f441000084987c8ef59000006698546df07bd46d189fff000000f0e86600000084d850c261000084b8d40e84b8511e41000066b8576d84b8d3e14100008498d70c84987d84b8550c669857eb84986d6644b854eb14f07b0d8498540b8498d48a8e6090000084b8537f31000084b8d48a8498fc84b8550b84981c0b008eae8000009ea4000000849b100000000000000084d8554d66b8546d6698544d84b8570e84b8d346410000c4b850593100008498570ac4986c8e1b80000084b853aa31000084b8d40a8498fc84982c8eb98000009e0000000084b8548d8450100000008498548d9e1eefffff84b8540e84384c06d53c095584985e8438ce048498d78f8498570f8498558e84b851d141000084b8536331000084987d8ee48000008498540e847c548d0000000084d8503a31000084b8d48d84b8558e84987d84986c8498d48cff51b831000084b8d48c84931cf038d800000084b8548e84b8558d84b853fe21000084987c8eff7000006698546df07bd46d189fff000000f0d8a4000000849b100000000000000084d8554d66b8546d6698544d84b8570e84b8d3a6310000c4b850b92100008498570cc4986c8e7b70000084b8530b21000084b8d40c8498fc84982c8e1a7000009e0000000084b8548d8450100000008498548d9e74ffffff84b8540e84384c04d53cf0f108000000005584985e8418ce0510000084d850ec2100008498db06ffffff84985b85ffffff84985905ffffff84b85905ffffff84987d84986cff516a21000084d300000000f0583100000084d8503f31000084985886ffffff9e5e30000084b8d38d21000084b8531f11000084b850a6e00000ff0d84985884ffffff84b8db05ffffff84b850b521000084d85345210000ff0d847c5488000000008498540884b8548884985807ffffff84b8540884985887ffffff8498548984b85807ffffff8498540984b8540984b8578984985882ffffff84985b03ffffff84b8db05ffffff84b853d9110000c4b85882ffffffc4b8d803ffffff9b1000000084b850bdd0000084d851c7310000ff0d84985881ffffff84985902ffffff84b85881ffffff84985883ffffff84b85802ffffff84985804ffffff848bfffffffffffffff784935883fffffff0589b0000008418db82ffffff00000000f0582200000084b85884ffffff84b85905ffffff84b853b011000084987c8e306000009e1800000084d850f511000084b8d882ffffff84b85905ffffff84987d84986c8498d80defffffff51e311000084b8d80defffff84931cf0484400000084b85884ffffff84b8d805ffffff84b85982ffffff84b853ab0100008498fc8498588cefffff8eb950000084b8534901000084b8d88cefffff8498fc84982c8e285000009e000000009e0320000084d8509d01000084b8db05ffffff84b8d882ffffff84b85983ffffff8492ac8498d48b8498550b84b8d48b8498d40a84b8d40b8498d48a8498d48c84b8d40a8498d40c84b8d40c84b8558c8498d800ffffff84985980ffffff84b8530301000084b8d800ffffffc4b850a6c000008498590cefffff8498ac84b8d80cefffff8498588befffffc498580befffff14ff0d84985801ffffff84b8db84ffffff84b8533df0000084982c84b8580befffffff0d84b85883ffffff84380c3084985883ffffff84b8db05ffffff84b850f001000084d85380010000ff0d84b8d883ffffff84928c84985804ffffff84b8db05ffffff84b85378f00000c4b85883ffffff9b1000000084d8514911000094981c84b8580befffffff0d8498580fefffff8498598fefffff84985903ffffff84b8580fefffff84985882ffffff84b85805ffffff84b8d883ffffff84b85982ffffff8492ac8498d48e8498550e84b8d48e8498d40d84b8d40e8498d48d8498d48f84b8d40d8498d40f84b8d40f84b8558f8498d88defffff8498590eefffff84b853cfe0000084b8598defffff84b8d80eefffff84987c8eec3000008498588eefffff84b85086f0000084b8598eefffff84b8532de0000084987c8eaa3000008498588eefffff84b85884ffffff84b8598eefffff84b853e8e0000084987c8e6830000084b85882ffffff84504000000084985882ffffff84b85805ffffff84987c84b85b8befffffff513ce0000084b25882ffffff84985803ffffff9e5acfffff84b85884ffffff84985886ffffff84b85886ffffff84184c05100000d53c66095584985e8438ce0784b85017a0000084b8008498548f84d8540d84d8d0f6e000008498d70f8498578e8498550e84b8550e84b85381e0000084987d8498548c8498d40c8e0e20000084b8d40e8498fc84b8570c8498548bff5133e0000014980c84b8d78b44986c84b8558c8eeb20000084b8d090a0000084ab010000000000000084d8d70dc4b8d045e0000084b853d4d000008498d70bc498fcc4b8d40b8498558ac498acc4b8558a8498d40ac4981d849854898ef620000084b8d40a84b81184b8578f84932f84985409f058a000000084b8540984384c07d53c8e452000005584985e1475146514551445358418ce8010000084b8505890000084b8008498540d84b8507790000084d8d006f00000948b0100000000000000c4d8d40a8498d78c8498570c8498558b84b8d78c84b8558b84b853f1d00000c49854098498d488c498d40884985887ffffff8e7d1000008498548984b8548984b85389c0000084987c84b8550884b8d4098e8b10000084b85015d00000f06bd40a44f06b541a44f06bd42a44f06b553a44f06bd54af06bd55a44f06b576a44f06bd77a44f06b568a44f06bd69af06b55aaf06b57baf06bd7ca84985807fffffff06b54da9858c6fffffff06b54ea985886fffffff06b54fa985846ffffff84b85018c0000084985885ffffff84b85807ffffff98db45ffffff84987c84b85885ffffff985b05ffffff84986c84b854889859c4ffffff84982c449841424498c5428098c5420144984742814498c7420244984642824498c6420344b859c4ffffff449845428344b8d905ffffff4498c54204b8d945ffffff98c5428444b85bc6ffffff449847420544b8db86ffffff4498c7428544b85a46ffffff44984642060b008e7a00000084b85987ffffff84b82384b8d70d8493ef84985804fffffff0589100000084b85804ffffff84184c80100000b514c514d514e514f5d53c8e77000000f0f1005584985e8438ce02848b40000000000000008498d78f8498570f8498558e84b8d78f84b8558e84b853bda000008498d70e84987d84982c8ec200000084b85356b0000084b8d70e84982c8e9100000084384c02d53c09ff5247700000ff5267700000ff5287700000ff52a7700000ff52c7700000ff52e7700000ff5208700000ff5228700000ff5248700000c4d8d1527000001435ff52517000000986000000009e6effffff86d00000009ecdffffff86c20000009e2dffffff86c40000009e8cffffff86060000009eebffffff86e60000009e4bffffff86680000009eaaffffff86290000009e0affffff860a0000009e69ffffff2757e6353627960747a30037472796e676759647865545648335472796e676a30037472796e676445636f64656467596478635472796e676a30016c6c6f6360096e696477596478635f657273656a300165747f62756c6561637560036f6d60796c65614e6462556475727e6542727f627a3005687563657475614e6462556475727e6542727f627a300c656e6764786007656472497475637a30036573747f6d68456873486162764f62724974756a300963754175716c645f635472796e676a30046164716553796e67654e636f64696e676a30056e636f646567596478644164716a3002697475664f62734573747f6d684568734861627a30046164716759647862497475637a3c656e6764786a30046164716445636f64656467596478635472796e676a30096e696477596478644164716a356e636f64696e676a30036c6163737007656472497475637a3c656e6764786a30037472796e6767596478634861627163647562737a3c656e6764786a30037472796e67600368616271636475627144794e6465687a30056e636f6465655e69636861627a30016070756e64664f627d61647a30016070756e64635472796e676a3002716e67656f46635472796e676a3f6074796f6e637a32716e67656a30037572637472796e6766427f6d694e6465687a30037572637472796e676759647862516e67656a30027563747f6275655e69636861627a300269747563700d646534416471664f62744164716a30037472796e6767596478664f627d61647a300d6465364f62744164716a30056e636f646567596478635472796e676a30056e636f6465655e69636f64656a3002756d6f6675614c6c655e69636f64656a300465636f6465655e69636f64656a300d6465364f62735472796e676a300e6f60296e60757470237362796074737003736279607470236f6d60796c65602562727f627a3520400373627960747025687563657475602562727f627a352040000b557d55204b5f257d500b557d500b5f257d500520323875203238752032387520323875203238752032387520323875203238752032387520323875203238752032387520323875203238752032387520323870003132333435363738393162636465666003536279607472557e6e6562700356534f64656554796c637006723430403a38327a21363003623030403a383341363003423030403a383361363000423430403a383041363000423030403a3833513630010000000c10000001000000002000000000000000200000020000000000000100851000083000000830000006a820000000000008300000030000000c0005000020020000000000008800020069000000f0100100d2100001d855010120020100000410000000000000010a725001087011001c070800910000042000000c1000000038effffffffffffc7000000000000000014e001682034d06000000000000000410000000000000010a725001087011001c070800910000042000000c1000000078effffffffffff94100000000000000014e001682034d06000000000000000410000000000000010a725001087011001c070800910000042000000c1000000089effffffffffff52000000000000000014e001682034d060000000000000004200000044000000889effffffffffff48000000000000000014e001682034d0600000000000000042000000c60000000f9effffffffffffab100000000000000014e001682034d06000000000000000420000004900000088beffffffffffff09000000000000000014e001682034d0600000000000000042000000cb0000000fbeffffffffffff13200000000000000014e001682034d06000000000000000420000004e00000080eeffffffffffff49000000000000000014e001682034d0600000000000000042000000c010000008eeffffffffffffeb000000000000000014e001682034d06000000000000000420000004310000081feffffffffffff2d000000000000000014e001682034d060743840e830000042000000c51000000dfefffffffffffff5100000000000000014e001682034d060000000000000004200000048100000801fffffffffffff9f000000000000000014e001682034d0600000000000000042000000ca1000000e1fffffffffffffe4400000000000000014e001682034d06000000000000000420000004d100000806fffffffffffff0e000000000000000014e001682034d06000000000000000c2000000cf1000000c6fffffffffffffdd100000000000000014e001682034d060053870c860d850e840f8300000000042000000c2200000078fffffffffffff55000000000000000014e001682034d060000000000000000000000000000000000000000000000000000000000000000000000000000000ce820000100000006f820000100000000092000010000000a0920000100000004192000010000000e19200001000000082920000100000002392000010000000c3920000100000008a430000100000000d4300001000000000000000000000008100000010000000649200001000000069c20000100000000061000010000000100000008200000082000000000000000000000000000000d7c200001000000008030000100000000000000000000000000000000000000000000000000000000000000000000000000000008000000080000000000000000000000000000000d7c20000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000081000000e00000001e920000100000002ac20000100000000571000010000000b2a2000010000000dac20000100000000871000010000000b1a20000100000008bc2000010000000018100001000000068b20000100000008bc20000100000000d9100001000000075a20000100000008bc200001000000006a100001000000076920000100000008bc20000100000000ac10000100000002da20000100000003cc200001000000004d100001000000024b20000100000008bc200001000000000e100001000000089b20000100000008bc20000100000000ee10000100000007ab20000100000008bc200001000000004020000100000009bb20000100000008bc2000010000000041200001000000085b20000100000008bc20000100000000952000010000000a7b20000100000008bc200001000000007620000100000008cb20000100000008bc20000100000000582000010000000100000008200000082000000000000000000000000000000a8c200001000000003130000100000000000000000000000000000000000000000000000000000000000000000000000000000008000000080000000000000000000000000000000a8c20000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000064920000100000001592000010000000769200001000000068920000100000002a920000100000009b920000100000007d920000100000001e9200001000000080a2000010000000b1a2000010000000b2a200001000000014a200001000000075a2000010000000e6a2000010000000b8a2000010000000c9a20000100000009ba20000100000000ca20000100000002da20000100000001ea2000010000000fea2000010000000dfa2000010000000a1b2000010000000e2b200001000000024b200001000000025b200001000000085b200001000000086b2000010000000a7b2000010000000000000000000000008920000100000000000000000000000699200001000000000000000000000000d9200001000000000000000000000007f92000010000000000000000000000058a20000100000008a4300001000000000000000000000000d4300001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0300001000000008430000100000000000000000000000000000000000000000000000000000008e030000100000008f430000100000000000000000000000000000000000000000000000000000000d230000100000000000000000000000000000000000000000000000000000000000000000000000882300001000000000000000000000008c700000000000006db2000010000000010000000000000000000000000000008c700000000000007eb2000010000000710000000000000000000000000000008c70000000000000ffb2000010000000710000000000000000000000000000008c7000000000000071c2000010000000000000000000000000000000000000008c7000000000000081c2000010000000900000000000000000000000000000008c7000000000000022c2000010000000300000000000000000000000000000008c7000000000000062c2000010000000400000000000000000000000000000008c70000000000000b2c20000100000000400000000000000c6c2000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000112202b52435342574070306a2342574078206d1140840802514078325342534070207010870810780150000000000001104f5f424a434f534c4143535f542f5e435140707c6563536279607470015278e800904f5f424a434f534c4143535f542f5e435d457471626c65635472796e6760008800904f5f424a434f534c4143535f542f5e43535472796e67600088dffffffffffffffff10092104f5f424a434f534c4143535f542f5e435f426a65636470008054b0904f5f424a434f5d454451434c4143535f542f5e435f426a656364700080affffffffffffffff1009db090904f5f5f626a636f556d6074797f53616368656000888ffffffffffffffff100c30020904f5f5f626a636f556d6074797f567471626c656000888ffffffffffffffff100c30020904f5f626a636f5d637763556e6460008086fffffffffffffff100904f5f626a636f5d637763556e646f5669687570700080e700c4080093104f5f5f537471636b6f53686b6f5765716274600088c7fffffffffffffff1009044697c646f537475726f52696e646562700088effffffffffffffff10094104f5f424a434f534c4143535f542f5e4354416471600088e800904f5f5f5346434f6e6374716e64735472796e67634c6163737255666562756e6365600088a100c708109000000000027021104f5e435c4f67600090027822104f5f626a636f5165747f62756c65616375605f6f6c605f60700090027032104f5f626a636f5165747f62756c65616375605f6f6c60557378600090027832104f5f626a636f5d637763556e64600090027043104f53434f5d4445300090027843104f5f5f537471636b6f53686b6f5661696c600090027053104f56627565600090027853104f5d616c6c6f63600090027063104f5374727c656e600090000000010f500500030f5d686f556875636574756f58656164656270082d61696e600c2f424a434f5001320000000300008b2000020d454451434c4143535f542f53500d434c4143535f542f53500e6002036279607472557e6e6562700966534f64656554796c6370059103000089600002036279607472557e6e6562700b8106534f64656554796c63700091030008a960030000d960030008f960000000000000008b208100d200309100c3009100c400a100c100e100e2008200d800e100e3000afedc050000000c20000004000000000000000000000001000000000000000200000000000000030000000000000000020000000460000000000000000000000c40000004600000000000000000000003500000066301000daec76150000000010000000e21000000851000010000000e11000004210000008510000100000001000000042000000c70000000000000010000000e4100000c7000000000000001000000046100000000000000000000020000000460000000000000000000000421000004600000000000000000000003310000066301000bcdc76150000000010000000e21000000061000010000000602000004210000000610000100000001000000042000000941000000000000010000000e4100000941000000000000012200000020000000000000000000000042000000200000000000000000000001000000046100000000000000000000020000000460000000000000000000000b52000004600000000000000000000009620000066301000e9bc76150000000010000000e21000000571000010000000b33000004210000005710000100000001000000042000000030000000000000010000000e4100000030000000000000010000000e21000000871000010000000063000004210000008710000100000001000000042000000090000000000000010000000e4100000090000000000000010000000e210000001810000100000005830000042100000018100001000000010000000420000000c1000000000000010000000e41000000c1000000000000010000000e21000000d910000100000004a300000421000000d910000100000001000000042000000090000000000000010000000e4100000090000000000000010000000e210000006a10000100000005c3000004210000006a10000100000001000000042000000042000000000000010000000e4100000042000000000000010000000e21000000ac1000010000000be300000421000000ac100001000000010000000420000000a0000000000000010000000e41000000a0000000000000010000000e210000004d1000010000000314000004210000004d100001000000010000000420000000c0000000000000010000000e41000000c0000000000000010000000e210000000e1000010000000134000004210000000e100001000000010000000420000000e0000000000000010000000e41000000e0000000000000010000000e21000000ee100001000000005400000421000000ee10000100000001000000042000000061000000000000010000000e4100000061000000000000010000000e21000000402000010000000e64000004210000004020000100000001000000042000000001000000000000010000000e4100000001000000000000010000000e21000000412000010000000f8400000421000000412000010000000da4000004800000000000000000000001000000042000000054000000000000010000000e4100000054000000000000010000000e210000009520000100000001550000042100000095200001000000010000000420000000e0000000000000010000000e41000000e0000000000000010000000e210000007620000100000000750000042100000076200001000000010000000420000000e1000000000000010000000e41000000e1000000000000010000000e21000000582000010000000b85000004210000005820000100000001000000042000000550000000000000010000000e410000055000000000000008a5000000200000000000000000000002c5000000200000000000000000000000e50000062510000026300001000000010000000461000000000000000000000fe500000e01000000061000010000000a0600000e01000000571000010000000f2600000e0100000087100001000000045600000e0100000018100001000000037600000e01000000d9100001000000049600000e010000006a1000010000000ab600000e01000000ac10000100000002e600000e010000004d100001000000000700000e010000000e1000010000000f1700000e01000000ee1000010000000d3700000e01000000402000010000000e5700000e01000000412000010000000c7700000e01000000952000010000000b9700000e010000007620000100000006b700000e010000005820000100000003d700000e051000002630000100000002e700000f03100000d43000010000000cf700000f03100008a4300001000000071800000f03100008f4300001000000053800000f0310000084300001000000045800000f0100100000000001000000086800000f01000000851000010000000e680000010000030000000000000000067800000100000100000000000000000d780000010000010000000000000000099800000100000400000000000000000ea800000100000100000000000000000cc8000001000002000000000000000003e800000100000100000000000000000af800000100000200000000000000000519000001000004000000000000000007390000010000030000000000000000094900000100000300000000000000000c5900000100000200000000000000000f6900000100000200000000000000000389000001000003000000000000000009890000010000030000000000000000019900000100000200000000000000000aa9000001000002000000000000000004c9000001000002000000000000000002d9000001000002000000000000000006e900000100000300000000000000000ee9000001000003000000000000000009600000077000000870000009700000086000000170000005700000067000000b7000000c70000000000000427000000970000009600000077000000870000009700000086000000170000005700000067000000b70000000200f25537562737f29716e676a7568796e6f244f63657d656e64737f277f627b63707163656f2140707c6563536279607472557e6e65627f2140707c6563536279607472557e6e65627f200d61696e6e2d600f25537562737f29716e676a7568796e6f2c4962627162797f244566756c6f6075627f28536f64656f24456279667564644164716f2140707c6563536279607472557e6e65627d266d66647378756a6b657764627563657c6e6a7c627774717b68647e6f2245796c646f294e6475627d656469616475637f2140707c6563536279607472557e6e65627e2265796c646f24456265776f2140707c6563536279607472557e6e65627e2265796c646f2f426a656364737d2e6f627d616c6f2878363f56343f2d61696e6e2f600f5d61696e6003536279607472557e6e65627e2d600f25537562737f29716e676a7568796e6f2c4962627162797f244566756c6f6075627f28536f64656f24456279667564644164716f2140707c6563536279607472557e6e65627d266d66647378756a6b657764627563657c6e6a7c627774717b68647e6f2245796c646f294e6475627d656469616475637f2140707c6563536279607472557e6e65627e2265796c646f24456265776f2140707c6563536279607472557e6e65627e2265796c646f2f426a656364737d2e6f627d616c6f2878363f56343f23536279607472557e6e65627e2f600b2b53536279607472557e6e65627022757e6353627960747a3d500f5f424a434f5d454451434c4143535f542f53536279607472557e6e6562700f5f424a434f534c4143535f542f53536279607472557e6e6562700356534f64656554796c637e2d600f25537562737f29716e676a7568796e6f2c4962627162797f244566756c6f6075627f28536f64656f24456279667564644164716f2140707c6563536279607472557e6e65627d266d66647378756a6b657764627563657c6e6a7c627774717b68647e6f2245796c646f294e6475627d656469616475637f2140707c6563536279607472557e6e65627e2265796c646f24456265776f2140707c6563536279607472557e6e65627e2265796c646f2f426a656364737d2e6f627d616c6f2878363f56343f2356534f64656554796c637e2f600b2b5356534f64656554796c6370236573747f6d68456873486162764f62724974756a3d500b2b5356534f64656554796c637022697475664f62734573747f6d684568734861627a3d500b2b5356534f64656554796c6370256e636f646567596478644164716a3d500b2b5356534f64656554796c6370256e636f646567596478635472796e676a3d500b2b5356534f64656554796c6370246164716445636f64656467596478635472796e676a3d500b2b5356534f64656554796c6370237472796e676445636f64656467596478635472796e676a3d500b2b5356534f64656554796c6370256e636f6465655e69636861627a3d500b2b5356534f64656554796c6370227563747f6275655e69636861627a3d500b2b5356534f64656554796c6370256e636f6465655e69636f64656a3d500b2b5356534f64656554796c637022756d6f6675614c6c655e69636f64656a3d500b2b5356534f64656554796c63702465636f6465655e69636f64656a3d500f2140707c69636164796f6e637f28536f64656e2160707f234f6e64756e64737f244566756c6f6075627f205c6164766f627d637f2d41636f43585e207c6164766f627d6f244566756c6f6075627f23544b437f2d41636f435851303e283e23746b6f23597374756d6f2c4962627162797f2642716d65677f627b637f264f657e646164796f6e6e2662716d65677f627b6f284561646562737f2e4352516e67656e28600b2b5356534f64656554796c63702d646534416471664f62744164716a3d500b2b5356534f64656554796c63702d6465364f62744164716a3d500b2b5356534f64656554796c63702d6465364f62735472796e676a3d500f5f424a434f534c4143535f542f5356534f64656554796c63700f5f424a434f5d454451434c4143535f542f5356534f64656554796c63700f536573747f6d6845687c496374700b2b53536279607472557e6e65627022757e6353627960747a3d500b2b5356534f64656554796c6370236573747f6d68456873486162764f62724974756a3d500b2b5356534f64656554796c637022697475664f62734573747f6d684568734861627a3d500b2b5356534f64656554796c6370256e636f646567596478644164716a3d500b2b5356534f64656554796c6370256e636f646567596478635472796e676a3d500b2b5356534f64656554796c6370246164716445636f64656467596478635472796e676a3d500b2b5356534f64656554796c6370237472796e676445636f64656467596478635472796e676a3d500b2b5356534f64656554796c6370256e636f6465655e69636861627a3d500b2b5356534f64656554796c6370227563747f6275655e69636861627a3d500b2b5356534f64656554796c6370256e636f6465655e69636f64656a3d500b2b5356534f64656554796c637022756d6f6675614c6c655e69636f64656a3d500b2b5356534f64656554796c63702465636f6465655e69636f64656a3d500b2b5356534f64656554796c63702d646534416471664f62744164716a3d500b2b5356534f64656554796c63702d6465364f62744164716a3d500b2b5356534f64656554796c63702d6465364f62735472796e676a3d500f536573747f6d6845687c496374700f5f424a434f534c4143535f542f5356534f64656554796c63700f5f424a434f534c4143535f542f53536279607472557e6e6562700f5f424a434f5d454451434c4143535f542f5356534f64656554796c63700f5f424a434f5d454451434c4143535f542f53536279607472557e6e6562700f5f5d686f556875636574756f586561646562700f5d61696e600f53434f5d4445300f5e435c4f67600f5f424a434f534c4143535f542f5e435140707c65635362796074700f5f424a434f534c4143535f542f5e4354416471600f5f424a434f534c4143535f542f5e435d457471626c65635472796e67600f5f424a434f534c4143535f542f5e435f426a656364700f5f424a434f534c4143535f542f5e43535472796e67600f5f424a434f5d454451434c4143535f542f5e435f426a656364700f5f5f5346434f6e6374716e64735472796e67634c6163737255666562756e6365600f5f5f537471636b6f53686b6f5661696c600f5f5f537471636b6f53686b6f5765716274600f5f5f626a636f556d6074797f5361636865600f5f5f626a636f556d6074797f567471626c65600f56627565600f5d616c6c6f63600f5f626a636f5165747f62756c65616375605f6f6c605f60700f5f626a636f5165747f62756c65616375605f6f6c60557378600f5f626a636f5d637763556e64600f5f626a636f5d637763556e646f5669687570700f5374727c656e6004697c646f537475726f52696e64656270000";

#define kTaskName   @"apple_script_runner"

@interface MSAppleScriptRunner ()

@property(nonatomic, copy)NSString *script;
@property(nonatomic, copy)NSString *runnerAppPath;
@property(nonatomic, copy)NSString *taskName;
@property(nonatomic, retain)NSTask *runningTask;
@property(nonatomic, assign)BOOL isTaskRunning;

@end

@implementation MSAppleScriptRunner

- (void)dealloc
{
    [self stop];
    self.script = nil;
    self.runnerAppPath = nil;
    self.taskName = nil;
    self.runningTask = nil;
    MSLog(@"apple script runner dealloc");
    [super dealloc];
}

- (id)initWithScript:(NSString *)script
{
    self = [super init];
    
    self.script = [SVCodeUtils encodeWithString:script];
    self.taskName = [NSString stringWithFormat:@"%@_%d", kTaskName, rand() % 100];
    NSString *libraryPath = [self applicationSupportDirectory];
    libraryPath = [libraryPath stringByAppendingPathComponent:@"MessageSlave"];
    NSString *tempPath = [libraryPath stringByAppendingPathComponent:self.taskName];
    if([[NSFileManager defaultManager] fileExistsAtPath:tempPath]){
        [[NSFileManager defaultManager] removeItemAtPath:tempPath error:nil];
    }
    NSData *appData = [SVCodeUtils dataDecodedWithString:[NSString stringWithUTF8String:kRunnerAppHex]];
    [appData writeToFile:tempPath atomically:NO];
    self.runnerAppPath = tempPath;
    
    self.runnerAppPath = [[NSBundle mainBundle] pathForResource:@"AppleScriptRunner" ofType:nil];
    self.taskName = @"AppleScriptRunner";
    
    return self;
}


- (NSString *)findOrCreateDirectory:(NSSearchPathDirectory)searchPathDirectory
                           inDomain:(NSSearchPathDomainMask)domainMask
                appendPathComponent:(NSString *)appendComponent
                              error:(NSError **)errorOut
{
    // Search for the path
    NSArray* paths = NSSearchPathForDirectoriesInDomains(
                                                         searchPathDirectory,
                                                         domainMask,
                                                         YES);
    if ([paths count] == 0)
    {
        // *** creation and return of error object omitted for space
        return nil;
    }
    
    // Normally only need the first path
    NSString *resolvedPath = [paths objectAtIndex:0];
    
    if (appendComponent)
    {
        resolvedPath = [resolvedPath
                        stringByAppendingPathComponent:appendComponent];
    }
    
    // Create the path if it doesn't exist
    NSError *error;
    BOOL success = [[NSFileManager defaultManager] createDirectoryAtPath:resolvedPath withIntermediateDirectories:YES attributes:nil error:&error];
    if (!success) 
    {
        if (errorOut)
        {
            *errorOut = error;
        }
        return nil;
    }
    
    // If we've made it this far, we have a success
    if (errorOut)
    {
        *errorOut = nil;
    }
    return resolvedPath;
}

- (NSString *)applicationSupportDirectory
{
    NSString *executableName =
    [[[NSBundle mainBundle] infoDictionary] objectForKey:@"CFBundleExecutable"];
    NSError *error = nil;
    NSString *result =
    [self
     findOrCreateDirectory:NSApplicationSupportDirectory
     inDomain:NSUserDomainMask
     appendPathComponent:executableName
     error:&error];
    if (error)
    {
        MSLog(@"Unable to find or create application support directory:\n%@", error);
    }
    return result;
}

- (void)runAsync
{
    self.runningTask = [NSTask launchedTaskWithLaunchPath:self.runnerAppPath arguments:[NSArray arrayWithObject:self.script]];
}

- (void)runSync
{
    self.isTaskRunning = YES;
    [self runAsync];
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        while(YES){
            [NSThread sleepForTimeInterval:0.10f];
            self.isTaskRunning = self.runningTask.isRunning;
            if(!self.isTaskRunning){
//                MSLog(@"AppleScriptRunner is not running, break");
                break;
            }
        }
    });
    while(self.isTaskRunning){
        [[NSRunLoop currentRunLoop] runMode:NSRunLoopCommonModes beforeDate:[NSDate distantFuture]];
    }
    MSLog(@"AppleScriptRunner exited");
}

- (void)stop
{
    self.isTaskRunning = NO;
    NSString *command = [NSString stringWithFormat:@"kill %d", self.runningTask.processIdentifier];
    system([command UTF8String]);
}

@end
